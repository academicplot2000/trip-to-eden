<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trip to Eden</title>
    <link rel="icon" href="logotriptoeden.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=IM+Fell+English:ital@0;1&family=Cinzel:wght@300;400&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="styles.css" />
    <script src="translations.js"></script>
  </head>
  <body>
    <!-- Sky background -->
    <div class="sky-canvas"></div>
    <div class="clouds-wrap" id="cloudsWrap"></div>

    <!-- Navigation dots -->
    <nav class="nav-dots" id="navDots">
      <button class="nav-dot active" data-page="0" title="Entrada" data-i18n-title="nav.entry"></button>
      <button class="nav-dot" data-page="1" title="La carta" data-i18n-title="nav.letter"></button>
      <button class="nav-dot" data-page="2" title="Tu asiento" data-i18n-title="nav.seats"></button>
    </nav>

    <!-- Language Switcher & Wattpad -->
    <div class="lang-switch">
      <a href="https://www.wattpad.com" target="_blank" class="wattpad-btn" title="Read on Wattpad">
        <!-- Simple Wattpad Icon (W) -->
        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
          <path d="M6.5,2C4.5,2,3,3.5,3,5.5v13C3,20.5,4.5,22,6.5,22S10,20.5,10,18.5v-10h4v10c0,2,1.5,3.5,3.5,3.5s3.5-1.5,3.5-3.5 v-13C21,3.5,19.5,2,17.5,2S14,3.5,14,5.5v7h-4v-7C10,3.5,8.5,2,6.5,2z"/>
        </svg>
      </a>
      <button class="lang-btn active" data-lang="es">ES</button>
      <button class="lang-btn" data-lang="en">EN</button>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE 1 â€“ ENTRADA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="section" id="page-entry">
      <div class="logo-wrap">
        <img
          class="logo-img"
          src="logotriptoeden.png"
          alt="Trip to Eden"
          onerror="
            this.style.display = 'none';
            document.querySelector('.logo-text-fallback').style.display =
              'block';
          "
        />
        <div class="logo-text-fallback" data-i18n="entry.fallbackTitle">Trip to Eden</div>
        <span class="logo-subtitle" data-i18n="entry.subtitle">a journey to your other half</span>
      </div>

      <div class="entry-form">
        <div class="input-field-wrap">
          <label class="input-label" for="nameInput" data-i18n="entry.labelName">Â¿CuÃ¡l es tu nombre?</label>
          <input
            class="name-input"
            id="nameInput"
            type="text"
            placeholder=" "
            data-i18n-placeholder="entry.placeholderName" 
            autocomplete="off"
            spellcheck="false"
          />
          <span class="feather-hint">âœ¦</span>
          <div class="input-shimmer"></div>
        </div>

        <button class="btn-enter" id="btnEnter" data-i18n="entry.btnEnter">Continuar</button>
      </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE 2 â€“ LA CARTA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="section" id="page-letter">
      <p class="greeting-name" id="greetingName"></p>

      <div class="envelope-wrap" id="envelopeWrap">
        <img
          class="envelope-img"
          src="carta.png"
          alt="Tu carta"
          id="envelopeImg"
          onerror="
            this.style.display = 'none';
            document.getElementById('envelopeFallback').style.display = 'flex';
          "
        />
        <div
          class="envelope-fallback"
          id="envelopeFallback"
          style="display: none"
        >
          âœ‰
        </div>
        <span class="click-hint" data-i18n="letter.clickHint">â€” toca para abrir â€”</span>
      </div>
    </section>

    <!-- Puzzle overlay -->
    <div class="puzzle-overlay" id="puzzleOverlay">
      <div class="puzzle-box">
        <p class="puzzle-title" data-i18n="letter.puzzleTitle">desliza para abrir el sobre</p>
        <div class="slider-track" id="sliderTrack">
          <div class="slider-fill" id="sliderFill"></div>
          <span class="slider-label" id="sliderLabel" data-i18n="letter.sliderLabel">desliza â†’</span>
          <div class="slider-handle" id="sliderHandle"></div>
        </div>
      </div>
    </div>

    <!-- Letter content card -->
    <div class="letter-card-overlay" id="letterOverlay">
      <div class="letter-card" id="letterCard">
        <button class="letter-close" id="letterClose" data-i18n="letter.closeBtn">Ã— CERRAR</button>

        <img
          class="letter-logo"
          src="logotriptoeden.png"
          alt="Trip to Eden"
          onerror="this.style.display = 'none'"
        />

        <div class="letter-divider"></div>

        <p class="letter-salutation" id="letterSalutation" data-i18n="letter.salutation">Querida,</p>

        <p class="letter-body">
          <span data-i18n="letter.body1">Has sido seleccionada para participar en</span>
          <strong data-i18n="letter.bodySpan">Trip to Eden</strong><span data-i18n="letter.body2">.</span> <br /><br />
          <span data-i18n="letter.body3">Somos una startup especializada en encontrar a tu media naranja.
          DeberÃ¡s rellenar un breve formulario y seguir unos sencillos pasos.</span>
          <br /><br />
          <span data-i18n="letter.body4">SÃ© sincera en tus respuestas, y dÃ©jalo todo en nuestras manos.</span><br />
          <span data-i18n="letter.body5">El amor verdadero te espera al otro lado del cielo.</span>
        </p>

        <div class="letter-divider"></div>

        <!-- <p class="letter-seal">âœ¦</p> -->
        <!-- <p class="letter-signature">con cariÃ±o, Trip to Eden</p> -->
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE 3 â€“ ELIGE TU ASIENTO
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="section" id="page-seats">
      <div class="seats-header">
        <h2 class="seats-title" data-i18n="seats.headerTitle">Elige tu asiento</h2>
        <p class="seats-subtitle" data-i18n="seats.headerSubtitle">cada lugar guarda una experiencia distinta</p>
      </div>

      <div class="cabin" id="cabin">
        <!-- Rows generated by JS -->
      </div>

      <div class="btn-takeoff-wrap">
        <button class="btn-takeoff" id="btnTakeoff" data-i18n="seats.btnTakeoff">âœ¦ &nbsp; Despegar</button>
      </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COUNTDOWN OVERLAY
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="countdown-overlay" id="countdownOverlay">
      <div class="countdown-num" id="countdownNum">3</div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE 4 â€“ FORMULARIO
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="section" id="page-form">
      <div class="form-shell">
        <div class="form-progress-bar">
          <div class="form-progress-fill" id="formProgressFill"></div>
        </div>
        <span class="form-progress-label" id="formProgressLabel">1 / 12</span>
        <div class="form-question-wrap" id="formQuestionWrap"></div>
        <div class="form-nav">
          <button class="form-nav-btn" id="formPrev" data-i18n="form.prev">â€¹ &nbsp;Anterior</button>
          <button class="form-nav-btn primary" id="formNext" data-i18n="form.next">
            Siguiente &nbsp;â€º
          </button>
        </div>
      </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE 5 â€“ THANK YOU
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div
      class="page-thankyou"
      id="page-thankyou"
      style="display: none; opacity: 0"
    >
      <div class="ty-content">
        <img
          class="ty-logo"
          src="logotriptoeden.png"
          alt="Trip to Eden"
          onerror="this.style.display = 'none'"
        />
        <div class="ty-divider"></div>
        <p class="ty-title" data-i18n="thankyou.title">Tu historia comienza ahora.</p>
        <p class="ty-body">
          <span data-i18n="thankyou.body">Hemos recibido tu alma. Nuestro equipo estudiarÃ¡ cada respuesta con el
            cuidado que mereces.<br /><br />Cuando el momento sea el correcto, el
            cielo te enviarÃ¡ una seÃ±al.</span>
        </p>
        <p class="ty-seal">âœ¦</p>
        <p class="ty-sign" data-i18n="thankyou.sign">con cariÃ±o, Trip to Eden</p>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       JAVASCRIPT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script src="script.js"></script>
        { w: 260, h: 80 },
        { w: 180, h: 55 },
        { w: 320, h: 90 },
        { w: 140, h: 45 },
        { w: 220, h: 65 },
        { w: 380, h: 100 },
        { w: 170, h: 50 },
      ];

      function makeSVGCloud(w, h, id) {
        const ns = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(ns, "svg");
        svg.setAttribute("width", w);
        svg.setAttribute("height", h);
        svg.setAttribute("viewBox", `0 0 ${w} ${h}`);

        const stops = [
          { offset: "0%", color: "rgba(255,255,255,0.95)" },
          { offset: "60%", color: "rgba(235,242,252,0.85)" },
          { offset: "100%", color: "rgba(220,232,248,0.6)" },
        ];

        const defs = document.createElementNS(ns, "defs");
        const grad = document.createElementNS(ns, "radialGradient");
        grad.setAttribute("id", `cg${id}`);
        grad.setAttribute("cx", "50%");
        grad.setAttribute("cy", "40%");
        grad.setAttribute("r", "55%");
        stops.forEach((s) => {
          const st = document.createElementNS(ns, "stop");
          st.setAttribute("offset", s.offset);
          st.setAttribute("stop-color", s.color);
          grad.appendChild(st);
        });
        defs.appendChild(grad);
        svg.appendChild(defs);

        const cx = w / 2,
          cy = h * 0.55,
          rx = w * 0.45,
          ry = h * 0.38;

        // Base ellipse
        const base = document.createElementNS(ns, "ellipse");
        base.setAttribute("cx", cx);
        base.setAttribute("cy", cy);
        base.setAttribute("rx", rx);
        base.setAttribute("ry", ry);
        base.setAttribute("fill", `url(#cg${id})`);
        svg.appendChild(base);

        // Puff circles on top
        [
          [0.25, 0.35, 0.28],
          [0.5, 0.22, 0.32],
          [0.75, 0.32, 0.26],
        ].forEach(([px, py, pr]) => {
          const c = document.createElementNS(ns, "circle");
          c.setAttribute("cx", w * px);
          c.setAttribute("cy", h * py);
          c.setAttribute("r", Math.min(w, h) * pr);
          c.setAttribute("fill", `url(#cg${id})`);
          svg.appendChild(c);
        });

        return svg;
      }

      function spawnClouds() {
        const wrap = document.getElementById("cloudsWrap");
        const count = 14;
        for (let i = 0; i < count; i++) {
          const def = CLOUD_DATA[i % CLOUD_DATA.length];
          const scale = 0.7 + Math.random() * 0.9;
          const w = Math.round(def.w * scale);
          const h = Math.round(def.h * scale);

          const cloud = document.createElement("div");
          cloud.classList.add("cloud");
          cloud.style.top = Math.random() * 90 + "%";
          cloud.style.left = -w + "px";

          const dur = 45 + Math.random() * 50;
          const delay = -Math.random() * dur;
          cloud.style.animation = `floatCloud ${dur}s linear ${delay}s infinite`;
          cloud.style.opacity = (0.4 + Math.random() * 0.5).toString();

          cloud.appendChild(makeSVGCloud(w, h, i));
          wrap.appendChild(cloud);
        }
      }

      spawnClouds();

      /* â”€â”€â”€ Nav dots & scroll tracking â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      const sections = ["page-entry", "page-letter", "page-seats"];
      const dots = document.querySelectorAll(".nav-dot");

      dots.forEach((dot) => {
        dot.addEventListener("click", () => {
          const idx = parseInt(dot.dataset.page);
          document
            .getElementById(sections[idx])
            .scrollIntoView({ behavior: "smooth" });
        });
      });

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((e) => {
            if (e.isIntersecting) {
              const idx = sections.indexOf(e.target.id);
              dots.forEach((d, i) => d.classList.toggle("active", i === idx));
            }
          });
        },
        { threshold: 0.6 },
      );

      sections.forEach((id) => observer.observe(document.getElementById(id)));

      /* â”€â”€â”€ Page 1 â€“ Name & Enter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      let userName = "";
      const nameInput = document.getElementById("nameInput");
      const btnEnter = document.getElementById("btnEnter");

      btnEnter.addEventListener("click", goToLetter);
      nameInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") goToLetter();
      });

      function goToLetter() {
        userName = nameInput.value.trim() || "";
        const greeting = document.getElementById("greetingName");
        greeting.textContent = userName
          ? `Bienvenida, ${userName}`
          : "Bienvenida";
        document.getElementById("letterSalutation").textContent = userName
          ? `Querida ${userName},`
          : "Querida,";
        document
          .getElementById("page-letter")
          .scrollIntoView({ behavior: "smooth" });
      }

      /* â”€â”€â”€ Page 2 â€“ Envelope & Slider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      const envelopeWrap = document.getElementById("envelopeWrap");
      const puzzleOverlay = document.getElementById("puzzleOverlay");
      const letterOverlay = document.getElementById("letterOverlay");
      const letterClose = document.getElementById("letterClose");

      envelopeWrap.addEventListener("click", () => {
        puzzleOverlay.classList.add("active");
      });

      letterClose.addEventListener("click", () => {
        letterOverlay.classList.remove("active");
      });

      // Slider drag
      const track = document.getElementById("sliderTrack");
      const handle = document.getElementById("sliderHandle");
      const fill = document.getElementById("sliderFill");
      const label = document.getElementById("sliderLabel");

      let dragging = false,
        startX = 0,
        currentLeft = 0;
      const handleW = 52;

      function getTrackWidth() {
        return track.getBoundingClientRect().width;
      }

      function startDrag(clientX) {
        dragging = true;
        startX = clientX - currentLeft;
        handle.style.transition = "none";
        fill.style.transition = "none";
      }

      function doDrag(clientX) {
        if (!dragging) return;
        const tw = getTrackWidth();
        const max = tw - handleW;
        let pos = clientX - startX;
        pos = Math.max(0, Math.min(pos, max));
        currentLeft = pos;
        handle.style.left = pos + "px";
        fill.style.width = pos + handleW + "px";

        const pct = pos / max;
        label.style.opacity = Math.max(0, 1 - pct * 2.5).toString();

        if (pct >= 0.92) finishSlide();
      }

      function endDrag() {
        if (!dragging) return;
        dragging = false;
        const tw = getTrackWidth();
        const max = tw - handleW;
        if (currentLeft / max < 0.92) resetSlider();
      }

      function resetSlider() {
        handle.style.transition = "left 0.4s cubic-bezier(.16,1,.3,1)";
        fill.style.transition = "width 0.4s cubic-bezier(.16,1,.3,1)";
        handle.style.left = "0";
        fill.style.width = handleW + "px";
        label.style.opacity = "1";
        currentLeft = 0;
      }

      function finishSlide() {
        dragging = false;
        puzzleOverlay.classList.remove("active");
        resetSlider();
        setTimeout(() => letterOverlay.classList.add("active"), 300);
      }

      // Mouse events
      handle.addEventListener("mousedown", (e) => startDrag(e.clientX));
      window.addEventListener("mousemove", (e) => doDrag(e.clientX));
      window.addEventListener("mouseup", () => endDrag());

      // Touch events
      handle.addEventListener(
        "touchstart",
        (e) => {
          e.preventDefault();
          startDrag(e.touches[0].clientX);
        },
        { passive: false },
      );
      window.addEventListener("touchmove", (e) => doDrag(e.touches[0].clientX));
      window.addEventListener("touchend", () => endDrag());

      /* â”€â”€â”€ Page 3 â€“ Seat map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      const SEAT_INFO = {
        window: {
          icon: "ðŸŒ…",
          title: "Asiento de ventanilla",
          desc: "El horizonte es tuyo. Contempla el cielo despejado y siente la suave luz del amanecer mientras el mundo queda atrÃ¡s.",
        },
        innerLeft: {
          icon: "ðŸŒ¸",
          title: "Asiento interior izquierdo",
          desc: "Rodeada de tranquilidad. Un aroma suave a flores envuelve el ambiente, perfecto para reflexionar en calma.",
        },
        innerRight: {
          icon: "âœ¨",
          title: "Asiento interior derecho",
          desc: "Lleno de luz difusa y calidez. Cada instante aquÃ­ vibra con una energÃ­a serena y misteriosa.",
        },
        aisle: {
          icon: "ðŸ•Šï¸",
          title: "Asiento de pasillo",
          desc: "Libertad y movimiento. Eres la primera en alzar el vuelo y la primera en descubrir lo que te espera.",
        },
      };

      const ROWS = ["A", "B", "C", "D"];
      const cabin = document.getElementById("cabin");

      ROWS.forEach((row, ri) => {
        const rowEl = document.createElement("div");
        rowEl.classList.add("seat-row");

        // Row number
        const rn = document.createElement("span");
        rn.classList.add("row-num");
        rn.textContent = row;
        rowEl.appendChild(rn);

        // 4 seats: [window, inner | aisle, inner-right, window]
        // Layout: W  I  |  I  W
        const seatTypes = ["window", "innerLeft", "innerRight", "aisle"];
        const labels = [`${row}1`, `${row}2`, `${row}3`, `${row}4`];
        const types = ["window", "innerLeft", "aisle", "window"]; // per column

        [
          { id: `${row}1`, type: "window" },
          { id: `${row}2`, type: "innerLeft" },
        ].forEach((s) => rowEl.appendChild(makeSeat(s.id, s.type)));

        const aisle = document.createElement("div");
        aisle.classList.add("aisle");
        rowEl.appendChild(aisle);

        [
          { id: `${row}3`, type: "innerRight" },
          { id: `${row}4`, type: "window" },
        ].forEach((s) => rowEl.appendChild(makeSeat(s.id, s.type)));

        cabin.appendChild(rowEl);
      });

      function makeSeat(id, type) {
        const info = SEAT_INFO[type];
        const seat = document.createElement("div");
        seat.classList.add("seat");
        seat.setAttribute("data-id", id);

        const ping = document.createElement("div");
        ping.classList.add("seat-ping");
        seat.appendChild(ping);

        const tip = document.createElement("div");
        tip.classList.add("seat-tooltip");
        tip.innerHTML = `
      <div class="tooltip-icon">${info.icon}</div>
      <div class="tooltip-seat-id">Asiento ${id}</div>
      <div class="tooltip-body">${info.desc}</div>
    `;

        seat.appendChild(tip);
        return seat;
      }

      /* â”€â”€â”€ Takeoff button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      document.getElementById("btnTakeoff").addEventListener("click", () => {
        const btn = document.getElementById("btnTakeoff");
        btn.style.opacity = "0.5";
        btn.style.pointerEvents = "none";
        btn.innerHTML = "âœ¦ &nbsp; Despegandoâ€¦";
        setTimeout(startCountdown, 800);
      });

      /* â”€â”€â”€ Countdown 3 2 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      function startCountdown() {
        const overlay = document.getElementById("countdownOverlay");
        overlay.classList.add("active");
        const num = document.getElementById("countdownNum");
        const counts = ["3", "2", "1", "âœ¦"];
        let i = 0;
        function tick() {
          num.classList.remove("pop");
          void num.offsetWidth;
          num.textContent = counts[i];
          num.classList.add("pop");
          i++;
          if (i < counts.length) {
            setTimeout(tick, 900);
          } else {
            setTimeout(() => {
              overlay.classList.remove("active");
              showFormPage();
            }, 700);
          }
        }
        tick();
      }

      /* â”€â”€â”€ Form logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      const QUESTIONS = [
        {
          id: "q1",
          type: "single",
          question: "Â¿Crees en el amor a primera vista?",
          sub: "Esa chispa que lo cambia todo en un instante.",
          options: [
            "Completamente",
            "Puede que sÃ­",
            "Soy escÃ©ptica",
            "No lo creo",
          ],
        },
        {
          id: "q2",
          type: "single",
          question: "Â¿Crees en el destino?",
          sub: "Que hay alguien escrito para ti en algÃºn lugar del universo.",
          options: [
            "SÃ­, lo siento profundamente",
            "Creo que el destino se construye",
            "A veces lo dudo",
            "Prefiero la casualidad",
          ],
        },
        {
          id: "q3",
          type: "slider_range",
          question: "Â¿QuÃ© importancia tiene el aspecto fÃ­sico?",
          sub: "Desliza para indicar cuÃ¡nto peso tiene en tu decisiÃ³n.",
          min: 0,
          max: 10,
          labels: ["Nada", "Es lo primero"],
        },
        {
          id: "q4",
          type: "multi",
          question: "Â¿QuÃ© cualidades buscas en tu media naranja?",
          sub: "Elige todas las que resuenen contigo.",
          options: [
            "Sentido del humor",
            "Inteligencia emocional",
            "AmbiciÃ³n",
            "Ternura",
            "Aventurero/a",
            "Estabilidad",
            "Creatividad",
            "Lealtad",
          ],
        },
        {
          id: "q5",
          type: "slider_range",
          question: "Â¿Introvertido/a o extrovertido/a?",
          sub: "Describe cÃ³mo te imaginas a esa persona en sociedad.",
          min: 0,
          max: 10,
          labels: ["Muy introvertido/a", "Muy extrovertido/a"],
        },
        {
          id: "q6",
          type: "text",
          question: "Describe tu plan de cita perfecta.",
          sub: "Con todo detalle. No hay respuesta incorrecta.",
          placeholder: "Una cena tranquila al atardecer, tal vez junto al marâ€¦",
        },
        {
          id: "q7",
          type: "single",
          question: "Â¿CÃ³mo prefieres que sea la relaciÃ³n al principio?",
          sub: "El ritmo marca mucho el tono de todo lo que viene despuÃ©s.",
          options: [
            "Lenta y misteriosa",
            "Natural y espontÃ¡nea",
            "Intensa desde el inicio",
            "Que fluya sola",
          ],
        },
        {
          id: "q8",
          type: "multi",
          question: "Â¿QuÃ© planes os imaginas compartiendo?",
          sub: "Elige los que sientas como tuyos.",
          options: [
            "Viajes al extranjero",
            "Noches en casa",
            "Aventuras al aire libre",
            "Conciertos y cultura",
            "Proyectos en comÃºn",
            "Cocinar juntos",
            "Deporte",
            "Lectura en silencio",
          ],
        },
        {
          id: "q9",
          type: "slider_range",
          question: "Â¿QuÃ© equilibrio buscas entre independencia y uniÃ³n?",
          sub: "Cada pareja tiene su propia constelaciÃ³n.",
          min: 0,
          max: 10,
          labels: ["Mucha independencia", "Siempre juntos"],
        },
        {
          id: "q10",
          type: "single",
          question: "Â¿QuÃ© te enamora primero de alguien?",
          sub: "Ese pequeÃ±o detalle que lo cambia todo.",
          options: ["La mirada", "La voz", "La forma de reÃ­r", "Lo que dice"],
        },
        {
          id: "q11",
          type: "text",
          question:
            "Si pudieras dejarle una nota a tu media naranja hoy, Â¿quÃ© le dirÃ­as?",
          sub: "EscrÃ­bele como si pudiera leerla ahora mismo.",
          placeholder: "Hola, no sÃ© dÃ³nde estÃ¡s, peroâ€¦",
        },
        {
          id: "q12",
          type: "signature",
          question: "Para finalizar, firma aquÃ­.",
          sub: "Tu firma es tu sello. Confirma que todo lo que has respondido viene de tu corazÃ³n.",
        },
      ];

      let currentQ = 0;
      const answers = {};

      function showFormPage() {
        const pf = document.getElementById("page-form");
        pf.classList.add("visible");
        pf.style.display = "flex";
        requestAnimationFrame(() => {
          pf.scrollIntoView({ behavior: "smooth" });
        });
        // Add form nav dot
        const nd = document.createElement("button");
        nd.classList.add("nav-dot");
        nd.dataset.page = "3";
        nd.title = "Formulario";
        nd.addEventListener("click", () =>
          document
            .getElementById("page-form")
            .scrollIntoView({ behavior: "smooth" }),
        );
        document.getElementById("navDots").appendChild(nd);
        renderQuestion(0);
      }

      function renderQuestion(idx) {
        currentQ = idx;
        const q = QUESTIONS[idx];
        const container = document.getElementById("formQuestionWrap");

        // Update progress
        const pct = (idx / (QUESTIONS.length - 1)) * 100;
        document.getElementById("formProgressFill").style.width = pct + "%";
        document.getElementById("formProgressLabel").textContent =
          `${idx + 1} / ${QUESTIONS.length}`;

        // Fade out then swap
        container.style.opacity = "0";
        container.style.transform = "translateY(16px)";

        setTimeout(() => {
          container.innerHTML = buildQuestion(q);
          attachQuestionEvents(q);
          restoreAnswer(q);
          container.style.transition =
            "opacity 0.5s ease, transform 0.5s cubic-bezier(.16,1,.3,1)";
          container.style.opacity = "1";
          container.style.transform = "translateY(0)";
        }, 220);

        // Prev/Next buttons
        const prevBtn = document.getElementById("formPrev");
        const nextBtn = document.getElementById("formNext");
        prevBtn.style.opacity = idx === 0 ? "0.2" : "1";
        prevBtn.style.pointerEvents = idx === 0 ? "none" : "all";
        nextBtn.innerHTML =
          idx === QUESTIONS.length - 1 ? "Enviar &nbsp;âœ¦" : "Siguiente &nbsp;â€º";
      }

      function buildQuestion(q) {
        let html = `
      <p class="fq-label">Pregunta ${QUESTIONS.indexOf(q) + 1}</p>
      <h2 class="fq-title">${q.question}</h2>
      <p class="fq-sub">${q.sub || ""}</p>
    `;

        if (q.type === "single") {
          html += `<div class="fq-options single-options">`;
          q.options.forEach((opt, i) => {
            html += `<button class="fq-option" data-val="${opt}">${opt}</button>`;
          });
          html += `</div>`;
        }

        if (q.type === "multi") {
          html += `<div class="fq-options multi-options">`;
          q.options.forEach((opt) => {
            html += `<button class="fq-option" data-val="${opt}">${opt}</button>`;
          });
          html += `</div><p class="fq-hint">Puedes elegir varias</p>`;
        }

        if (q.type === "slider_range") {
          html += `
        <div class="fq-slider-wrap">
          <div class="fq-slider-labels">
            <span>${q.labels[0]}</span><span>${q.labels[1]}</span>
          </div>
          <div class="fq-slider-track">
            <div class="fq-slider-fill" id="fqFill"></div>
            <div class="fq-slider-thumb" id="fqThumb"></div>
          </div>
          <div class="fq-slider-value" id="fqValue">â€”</div>
        </div>`;
        }

        if (q.type === "text") {
          html += `
        <div class="fq-text-wrap">
          <textarea class="fq-textarea" id="fqText" placeholder="${q.placeholder || ""}" rows="4"></textarea>
        </div>`;
        }

        if (q.type === "signature") {
          html += `
        <div class="fq-sig-wrap">
          <canvas class="sig-canvas" id="sigCanvas"></canvas>
          <button class="sig-clear" id="sigClear">Borrar</button>
        </div>`;
        }

        return html;
      }

      function attachQuestionEvents(q) {
        if (q.type === "single") {
          document.querySelectorAll(".fq-option").forEach((btn) => {
            btn.addEventListener("click", () => {
              document
                .querySelectorAll(".fq-option")
                .forEach((b) => b.classList.remove("selected"));
              btn.classList.add("selected");
              answers[q.id] = btn.dataset.val;
            });
          });
        }

        if (q.type === "multi") {
          document.querySelectorAll(".fq-option").forEach((btn) => {
            btn.addEventListener("click", () => {
              btn.classList.toggle("selected");
              if (!answers[q.id]) answers[q.id] = [];
              const val = btn.dataset.val;
              if (btn.classList.contains("selected")) {
                answers[q.id].push(val);
              } else {
                answers[q.id] = answers[q.id].filter((v) => v !== val);
              }
            });
          });
        }

        if (q.type === "slider_range") {
          initFQSlider(q);
        }

        if (q.type === "text") {
          const ta = document.getElementById("fqText");
          ta.addEventListener("input", () => {
            answers[q.id] = ta.value;
          });
        }

        if (q.type === "signature") {
          initSignature(q);
        }
      }

      function restoreAnswer(q) {
        const ans = answers[q.id];
        if (!ans) return;

        if (q.type === "single") {
          document.querySelectorAll(".fq-option").forEach((btn) => {
            if (btn.dataset.val === ans) btn.classList.add("selected");
          });
        }

        if (q.type === "multi") {
          document.querySelectorAll(".fq-option").forEach((btn) => {
            if (ans.includes(btn.dataset.val)) btn.classList.add("selected");
          });
        }

        if (q.type === "text") {
          const ta = document.getElementById("fqText");
          if (ta) ta.value = ans;
        }

        if (q.type === "slider_range" && typeof ans === "number") {
          // Slider restores inside initFQSlider via answers check
        }
      }

      /* â”€â”€ Form Range Slider â”€â”€â”€â”€â”€â”€â”€ */
      function initFQSlider(q) {
        const track = document.querySelector(".fq-slider-track");
        const thumb = document.getElementById("fqThumb");
        const fill = document.getElementById("fqFill");
        const valEl = document.getElementById("fqValue");

        let dragging = false;
        let value = answers[q.id] !== undefined ? answers[q.id] : 5;

        function setVal(v) {
          value = Math.max(0, Math.min(10, Math.round(v)));
          const pct = value / 10;
          const tw = track.getBoundingClientRect().width;
          const thumbW = 32;
          const pos = pct * (tw - thumbW);
          thumb.style.left = pos + "px";
          fill.style.width = pos + thumbW / 2 + "px";
          valEl.textContent = value;
          answers[q.id] = value;
        }

        function posToVal(clientX) {
          const rect = track.getBoundingClientRect();
          const thumbW = 32;
          const pct = Math.max(
            0,
            Math.min(
              1,
              (clientX - rect.left - thumbW / 2) / (rect.width - thumbW),
            ),
          );
          return pct * 10;
        }

        thumb.addEventListener("mousedown", () => (dragging = true));
        window.addEventListener("mousemove", (e) => {
          if (dragging) setVal(posToVal(e.clientX));
        });
        window.addEventListener("mouseup", () => (dragging = false));

        thumb.addEventListener(
          "touchstart",
          (e) => {
            dragging = true;
            e.preventDefault();
          },
          { passive: false },
        );
        window.addEventListener("touchmove", (e) => {
          if (dragging) setVal(posToVal(e.touches[0].clientX));
        });
        window.addEventListener("touchend", () => (dragging = false));

        track.addEventListener("click", (e) => setVal(posToVal(e.clientX)));

        // Init position after layout
        requestAnimationFrame(() => setVal(value));
      }

      /* â”€â”€ Signature Canvas â”€â”€â”€â”€â”€â”€â”€ */
      function initSignature(q) {
        const canvas = document.getElementById("sigCanvas");
        const ctx = canvas.getContext("2d");
        const wrap = canvas.parentElement;

        function resize() {
          const w = wrap.getBoundingClientRect().width - 2;
          canvas.width = w;
          canvas.height = 160;
        }
        resize();
        window.addEventListener("resize", resize);

        ctx.strokeStyle = "#3a4a5c";
        ctx.lineWidth = 1.8;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";

        let drawing = false,
          lastX = 0,
          lastY = 0;

        function getPos(e) {
          const rect = canvas.getBoundingClientRect();
          const src = e.touches ? e.touches[0] : e;
          return { x: src.clientX - rect.left, y: src.clientY - rect.top };
        }

        function start(e) {
          e.preventDefault();
          drawing = true;
          const p = getPos(e);
          lastX = p.x;
          lastY = p.y;
        }
        function draw(e) {
          if (!drawing) return;
          e.preventDefault();
          const p = getPos(e);
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(p.x, p.y);
          ctx.stroke();
          lastX = p.x;
          lastY = p.y;
          answers[q.id] = canvas.toDataURL();
        }
        function stop() {
          drawing = false;
          ctx.beginPath();
        }

        canvas.addEventListener("mousedown", start);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseup", stop);
        canvas.addEventListener("mouseleave", stop);
        canvas.addEventListener("touchstart", start, { passive: false });
        canvas.addEventListener("touchmove", draw, { passive: false });
        canvas.addEventListener("touchend", stop);

        document.getElementById("sigClear").addEventListener("click", () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          delete answers[q.id];
        });
      }

      /* â”€â”€ Form Nav â”€â”€â”€â”€â”€ */
      document.getElementById("formPrev").addEventListener("click", () => {
        if (currentQ > 0) renderQuestion(currentQ - 1);
      });

      document.getElementById("formNext").addEventListener("click", () => {
        if (currentQ < QUESTIONS.length - 1) {
          renderQuestion(currentQ + 1);
        } else {
          submitForm();
        }
      });

      /* â”€â”€ Submit â”€â”€â”€â”€â”€ */
      function submitForm() {
        document.getElementById("page-form").style.opacity = "0";
        document.getElementById("page-form").style.transition =
          "opacity 0.8s ease";
        setTimeout(() => {
          document.getElementById("page-form").style.display = "none";
          document.getElementById("page-thankyou").style.display = "flex";
          requestAnimationFrame(() => {
            document.getElementById("page-thankyou").style.opacity = "1";
            document
              .getElementById("page-thankyou")
              .scrollIntoView({ behavior: "smooth" });
          });
        }, 800);
      }
  </body>
</html>
